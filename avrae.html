---
layout: default
title: Avrae Quick Reference
---

<div class="hero-block">
  <h1>Avrae Command Reference</h1>
  <p>Fast search for syntax, aliases, and snippets.</p>
</div>

<div class="map-search-wrapper" style="max-width: 800px; flex-direction: column; gap: 15px;">
  
  <input type="text" id="cmdSearchInput" placeholder="Search commands (e.g. 'attack', 'check', 'map')..." autofocus style="width: 100%;">

  <div class="filter-toggles" style="display: flex; gap: 10px; justify-content: center; width: 100%;">
    <button class="tool-btn active" onclick="setFilter('All')" id="btn-all">All</button>
    <button class="tool-btn" onclick="setFilter('Player')" id="btn-player">Player</button>
    <button class="tool-btn" onclick="setFilter('DM')" id="btn-dm">DM Only</button>
  </div>

</div>

<div class="avrae-grid" id="cmd-grid">
  {% for cmd in site.data.avrae_commands %}
    <div class="cmd-card" 
         data-search="{{ cmd.title }} {{ cmd.tags }} {{ cmd.category }}"
         data-type="{{ cmd.type | default: 'Both' }}">
      
      <div class="cmd-header">
        <h3 class="cmd-title">{{ cmd.title }}</h3>
        <div style="display:flex; gap:5px;">
            {% if cmd.type == 'DM' %}
                <span class="cmd-badge" style="background:#4A332A; color:white;">DM</span>
            {% elsif cmd.type == 'Player' %}
                <span class="cmd-badge" style="background:#6B8E23; color:white;">PL</span>
            {% endif %}
            <span class="cmd-badge">{{ cmd.category }}</span>
        </div>
      </div>

      <div class="cmd-syntax-wrapper">
        <code class="cmd-code">{{ cmd.syntax }}</code>
      </div>

      <div class="cmd-footer">
        <span>Ex: <em>{{ cmd.example }}</em></span>
        
        {% if cmd.image %}
          <span class="demo-link" onclick="openModal('{{ cmd.image | relative_url }}')">
            ðŸŽ¥ View Demo
          </span>
        {% endif %}
      </div>

    </div>
  {% endfor %}
</div>

<div id="demo-modal" class="modal-overlay" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()"> 
    <img id="modal-img" src="">
    <div style="text-align:center; margin-top:10px;">
        <button class="tool-btn" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<script>
  let currentFilter = 'All';

  /* --- Filter Logic (Search + Toggle) --- */
  const searchInput = document.getElementById('cmdSearchInput');
  const allCards = document.querySelectorAll('.cmd-card');
  const btns = {
    'All': document.getElementById('btn-all'),
    'Player': document.getElementById('btn-player'),
    'DM': document.getElementById('btn-dm')
  };

  // 1. Handle Toggle Clicks
  function setFilter(type) {
    currentFilter = type;
    
    // Update Button Styles
    Object.values(btns).forEach(b => {
        b.style.background = 'var(--color-bg-controls)';
        b.style.color = 'var(--color-text)';
    });
    const activeBtn = btns[type];
    activeBtn.style.background = 'var(--palette-brand-main)';
    activeBtn.style.color = 'var(--palette-white)';

    // Re-run filter
    runFilter();
  }

  // 2. Handle Typing
  searchInput.addEventListener('keyup', runFilter);

  // 3. Main Filter Function
  function runFilter() {
    const filterText = searchInput.value.toLowerCase().trim();
    const terms = filterText.split(" ").filter(t => t.length > 0);

    allCards.forEach(card => {
      const searchData = card.getAttribute('data-search').toLowerCase();
      const cardType = card.getAttribute('data-type'); // "DM", "Player", or "Both"

      // Check Text Match
      const textMatch = terms.every(term => searchData.includes(term));

      // Check Type Match
      let typeMatch = true;
      if (currentFilter !== 'All') {
          // If filter is 'DM', show 'DM' and 'Both'
          // If filter is 'Player', show 'Player' and 'Both'
          if (cardType !== currentFilter && cardType !== 'Both') {
              typeMatch = false;
          }
      }

      card.style.display = (textMatch && typeMatch) ? 'flex' : 'none';
    });
  }

  /* --- Modal Logic --- */
  const modal = document.getElementById('demo-modal');
  const modalImg = document.getElementById('modal-img');

  function openModal(imgSrc) {
    modalImg.src = imgSrc;
    modal.style.display = 'flex';
  }

  function closeModal() {
    modal.style.display = 'none';
    modalImg.src = "";
  }
  
  document.addEventListener('keydown', (e) => {
    if (e.key === "Escape") closeModal();
  });
  
  // Initialize active state style manually on load
  setFilter('All');
</script>