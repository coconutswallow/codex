---
layout: default
title: Avrae Quick Reference
---

<div class="hero-block">
  <h1>Avrae Command Reference</h1>
  <p>Fast search for syntax, aliases, and snippets.</p>
</div>

<div class="map-search-wrapper" style="max-width: 1200px; flex-direction: column; gap: 15px;">
  <input type="text" id="cmdSearchInput" placeholder="Search commands (e.g. 'attack', 'check', 'map')..." autofocus style="width: 100%;">

  <div class="filter-toggles" style="display: flex; gap: 10px; justify-content: center; width: 100%;">
    <button class="tool-btn active" onclick="setFilter('All')" id="btn-all">All</button>
    <button class="tool-btn" onclick="setFilter('Player')" id="btn-player">Player</button>
    <button class="tool-btn" onclick="setFilter('DM')" id="btn-dm">DM Only</button>
  </div>
</div>

<div style="max-width: 1200px; margin: 0 auto; padding: 0 20px 5px; display: grid; grid-template-columns: 1.2fr 1.9fr 1.9fr; font-weight: bold; font-size: 0.8em; color: var(--color-text-muted); text-transform: uppercase;">
    <span class="hide-mobile">Command</span>
    <span class="hide-mobile">Syntax</span>
    <span class="hide-mobile">Example</span>
</div>

<div class="avrae-list-container" style="max-width: 1200px; margin: 0 auto; padding-bottom: 40px;">

  {% assign grouped_commands = site.data.avrae_commands | group_by: 'category' | sort: 'name' %}
  
  {% for group in grouped_commands %}
    <button class="accordion-header" onclick="toggleAccordion(this)">
        {{ group.name }}
    </button>

    <div class="accordion-content">
      {% for cmd in group.items %}
        <div class="cmd-row" 
             data-search="{{ cmd.title }} {{ cmd.tags }} {{ cmd.note }}"
             data-type="{{ cmd.type | default: 'Both' }}">
          
          <div class="col-heading">
            <div class="cmd-title">{{ cmd.title }}</div>
            <div class="cmd-meta">
                {% if cmd.type == 'DM' %}
                    <span class="cmd-badge" style="background:#4A332A; color:white;">DM</span>
                {% elsif cmd.type == 'Player' %}
                    <span class="cmd-badge" style="background:#6B8E23; color:white;">PL</span>
                {% endif %}
                </div>
            {% if cmd.note %}
                <div class="cmd-note-full" style="margin-top:5px; font-size:0.8em; font-style:italic;">{{ cmd.note }}</div>
            {% endif %}
          </div>

          <div class="col-code" data-label="Syntax">
            {{ cmd.syntax | escape }}
          </div>

          <div class="col-code" data-label="Example" style="color: var(--color-text);">
            {{ cmd.example | escape }}
            {% if cmd.image and cmd.image != "" %}
              <span class="demo-link-small" onclick="openModal('{{ cmd.image | relative_url }}')">
                ðŸŽ¥ Demo
              </span>
            {% endif %}
          </div>

        </div>
      {% endfor %}
    </div>
  {% endfor %}

</div>

<div id="demo-modal" class="modal-overlay" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()"> 
    <img id="modal-img" src="">
    <div style="text-align:center; margin-top:10px;">
        <button class="tool-btn" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<style>
    @media (max-width: 800px) { .hide-mobile { display: none; } }
</style>

<script>
  let currentFilter = 'All';

  const searchInput = document.getElementById('cmdSearchInput');
  // Select all accordion wrappers
  const accordions = document.querySelectorAll('.accordion-content');
  const headers = document.querySelectorAll('.accordion-header');

  const btns = {
    'All': document.getElementById('btn-all'),
    'Player': document.getElementById('btn-player'),
    'DM': document.getElementById('btn-dm')
  };

  /* --- Accordion Logic --- */
  function toggleAccordion(btn) {
      btn.classList.toggle('active');
      const content = btn.nextElementSibling;
      content.classList.toggle('open');
  }

  /* --- Filter Logic --- */
  function setFilter(type) {
    currentFilter = type;
    Object.values(btns).forEach(b => {
        b.style.background = 'var(--color-bg-controls)';
        b.style.color = 'var(--color-text)';
    });
    btns[type].style.background = 'var(--palette-brand-main)';
    btns[type].style.color = 'var(--palette-white)';
    runFilter();
  }

  searchInput.addEventListener('keyup', runFilter);

  function runFilter() {
    const filterText = searchInput.value.toLowerCase().trim();
    const terms = filterText.split(" ").filter(t => t.length > 0);
    const isSearching = (terms.length > 0 || currentFilter !== 'All');

    // Loop through every Category Group
    headers.forEach((header, index) => {
        const panel = accordions[index];
        const rows = panel.querySelectorAll('.cmd-row');
        let visibleCount = 0;

        rows.forEach(row => {
            const searchData = row.getAttribute('data-search').toLowerCase();
            const cardType = row.getAttribute('data-type'); 

            // 1. Text Match
            const textMatch = terms.every(term => searchData.includes(term));

            // 2. Type Match
            let typeMatch = true;
            if (currentFilter !== 'All') {
                if (cardType !== currentFilter && cardType !== 'Both') {
                    typeMatch = false;
                }
            }

            const isVisible = textMatch && typeMatch;
            row.style.display = isVisible ? 'grid' : 'none';
            if (isVisible) visibleCount++;
        });

        // Group Visibility Logic
        if (visibleCount > 0) {
            header.style.display = 'flex';
            
            // If searching, auto-expand found categories
            if (isSearching) {
                if (!panel.classList.contains('open')) {
                    panel.classList.add('open');
                    header.classList.add('active');
                }
            } else {
                // Optional: Collapse all if search is cleared? 
                // Currently leaving them as they were
            }
        } else {
            header.style.display = 'none'; // Hide empty categories
            panel.classList.remove('open');
            header.classList.remove('active');
        }
    });
  }

  /* --- Modal Logic --- */
  const modal = document.getElementById('demo-modal');
  const modalImg = document.getElementById('modal-img');

  function openModal(imgSrc) {
    modalImg.src = imgSrc;
    modal.style.display = 'flex';
  }

  function closeModal() {
    modal.style.display = 'none';
    modalImg.src = "";
  }
  
  document.addEventListener('keydown', (e) => {
    if (e.key === "Escape") closeModal();
  });
  
  setFilter('All');
</script>