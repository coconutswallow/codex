<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freeimage.host Plugin Upload</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .container { border: 1px solid #ccc; padding: 2rem; border-radius: 8px; background: #f9f9f9; }
        
        /* Custom Button Style */
        .custom-upload-btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .custom-upload-btn:hover { background-color: #0056b3; }

        /* Hidden target for the result code */
        #hidden-target { display: none; }
        
        /* Results area */
        #results { margin-top: 2rem; display: none; }
        .result-item { margin-bottom: 1.5rem; padding: 1rem; background: #fff; border: 1px solid #ddd; border-radius: 4px; }
        .url-box { background: #eee; padding: 0.5rem; word-break: break-all; font-family: monospace; margin-top: 0.5rem; }
        img { max-width: 100%; height: auto; margin-top: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="container">
    <h1>Upload Test</h1>
    <p>Click below to upload. The plugin will handle the popup.</p>

    <script async src="//freeimage.host/sdk/pup.js" data-url="https://freeimage.host/upload"></script>

    <button class="custom-upload-btn" 
            data-chevereto-pup-trigger 
            data-target="#hidden-target">
        Upload Image
    </button>
    
    <div id="hidden-target" contenteditable></div>

    <div id="results">
        <h2>Upload Result</h2>
        <div class="result-item">
            <strong>Full Image URL:</strong>
            <div id="urlDisplay" class="url-box"></div>
            
            <strong>Thumbnail / Preview:</strong><br>
            <img id="imagePreview" src="" alt="Preview">
        </div>
    </div>
</div>

<script>
    // Watch for the plugin to insert content into #hidden-target
    const targetNode = document.getElementById('hidden-target');
    const resultsDiv = document.getElementById('results');
    const urlDisplay = document.getElementById('urlDisplay');
    const imagePreview = document.getElementById('imagePreview');

    const observer = new MutationObserver((mutations) => {
        if (targetNode.innerHTML.trim() !== "") {
            // The plugin outputs BBCode or HTML. 
            // We'll parse the HTML string to find the src/href.
            const parser = new DOMParser();
            // "text/html" parser works even if the content is just a partial string
            const doc = parser.parseFromString(targetNode.innerHTML, 'text/html');
            
            const img = doc.querySelector('img');
            const link = doc.querySelector('a');

            if (img || link) {
                // Get the best available URL
                const src = img ? img.src : '';
                const href = link ? link.href : src;

                urlDisplay.textContent = href;
                imagePreview.src = src || href;
                resultsDiv.style.display = 'block';

                // Optional: Stop observing if you only want 1 upload
                // observer.disconnect(); 
            }
        }
    });

    observer.observe(targetNode, { childList: true, subtree: true, characterData: true });
</script>

</body>
</html>